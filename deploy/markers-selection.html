<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Data Exploration - Kidney Cancer – Development of taxonomical biomarkers for Ulva genus</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./cp-and-mt-phylogeny-reconstruction.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
#quarto-sidebar .sidebar-item-text {
  font-weight: bold;
}
#quarto-sidebar .chapter-number {
  font-weight: normal
}
#quarto-sidebar .chapter-title {
  font-weight: normal
}
#.nav-tabs .nav-link.active {
  background-color: rgba(239, 236, 255, 0.5);
}
</style>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Development of taxonomical biomarkers for Ulva genus</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./markers-selection.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Exploration - Kidney Cancer</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abstract</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cp-and-mt-dataset-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Ulva organellar genomes retrieval and preparation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cp-and-mt-phylogeny-reconstruction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Species tree reconstruction from organellar genomes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./markers-selection.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Exploration - Kidney Cancer</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#on-this-page" id="toc-on-this-page" class="nav-link active" data-scroll-target="#on-this-page"><span class="header-section-number">3.1</span> On this page</a></li>
  <li><a href="#organellar-gene-selection" id="toc-organellar-gene-selection" class="nav-link" data-scroll-target="#organellar-gene-selection"><span class="header-section-number">3.2</span> Organellar gene selection</a>
  <ul>
  <li><a href="#gene-distances-to-species-three" id="toc-gene-distances-to-species-three" class="nav-link" data-scroll-target="#gene-distances-to-species-three"><span class="header-section-number">3.2.1</span> gene distances to species three</a></li>
  </ul></li>
  <li><a href="#markers-selection" id="toc-markers-selection" class="nav-link" data-scroll-target="#markers-selection"><span class="header-section-number">3.3</span> Markers selection</a>
  <ul>
  <li><a href="#cp-only" id="toc-cp-only" class="nav-link" data-scroll-target="#cp-only"><span class="header-section-number">3.3.1</span> cp only</a></li>
  <li><a href="#mt-only" id="toc-mt-only" class="nav-link" data-scroll-target="#mt-only"><span class="header-section-number">3.3.2</span> mt only</a></li>
  <li><a href="#cp-mt" id="toc-cp-mt" class="nav-link" data-scroll-target="#cp-mt"><span class="header-section-number">3.3.3</span> cp + mt</a></li>
  </ul></li>
  <li><a href="#sec-lesson-learnt-markers-selection" id="toc-sec-lesson-learnt-markers-selection" class="nav-link" data-scroll-target="#sec-lesson-learnt-markers-selection"><span class="header-section-number">3.4</span> Lessons Learnt</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Exploration - Kidney Cancer</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="on-this-page" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="on-this-page"><span class="header-section-number">3.1</span> On this page</h2>
<p>Biological insights and take-home messages are at the bottom of the page at Lesson Learnt: <a href="#sec-lesson-learnt-markers-selection" class="quarto-xref"><span>Section 3.4</span></a>.</p>
<ul>
<li>Here we focus on samples from Kidney Cancers patients and their overall relationships.</li>
<li>We then explore the association between each Kidney Cancer subtype and the major clinical covariates (e.g.: sex, disease status, cancer stage, clinical outcome).</li>
</ul>
</section>
<section id="organellar-gene-selection" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="organellar-gene-selection"><span class="header-section-number">3.2</span> Organellar gene selection</h2>
<p>select genes based on their distance to the reconstructed CP+MT phylogenetic three</p>
<p>we select only 10 genes (6 cp and 4 mt) because doing the combination with all the 99 genes wilñl take forever</p>
<section id="gene-distances-to-species-three" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="gene-distances-to-species-three"><span class="header-section-number">3.2.1</span> gene distances to species three</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>        <span class="ex">python3.10</span> combinatorial_ML_phylogeny.py <span class="at">--infolder</span> <span class="st">"ANALYSES_AND_RESULTS/</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="st">09_combinatorial_phylogeny/00_cp_genes/,ANALYSES_AND_RESULTS/09_combinatorial_phylogeny/00_mt_genes/"</span> <span class="at">--names</span> <span class="st">"CP,MT"</span> <span class="at">--iqtree</span> /home/Andrea/Desktop/ANALYSES_AND_RESULTS/bin/iqtree-2.2.0-Linux/bin/iqtree2 <span class="at">--n_genes</span> 10 <span class="at">--outdir</span> /home/Andrea/Desktop/CP_MT/ANALYSES_AND_RESULTS/09_combinatorial_phylogeny/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#------------------------------------------------------------------------------#</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="do">## 3.3 - Genes distances                                                    ####</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># get cp ML gene trees</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>cp_ML_genes <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb2-6"><a href="#cb2-6"></a>filenames <span class="ot">=</span> <span class="fu">list.files</span>(<span class="st">"./03_cp_singleGene_ML/"</span>, <span class="at">pattern =</span> <span class="st">"*.contree"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>cp_ML_genes <span class="ot">=</span> <span class="fu">lapply</span>(filenames, ape<span class="sc">::</span>read.tree)</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="fu">names</span>(cp_ML_genes) <span class="ot">=</span> <span class="fu">str_remove_all</span>(<span class="fu">str_remove_all</span>(filenames, <span class="st">"./03_cp_singleGene_ML//"</span>), <span class="st">".aln.contree"</span>)</span>
<span id="cb2-9"><a href="#cb2-9"></a>cp_ML_genes[[<span class="st">"cp_mt_ML"</span>]] <span class="ot">=</span> phylogenetic_trees[[<span class="st">"cp_mt_ML"</span>]][[<span class="st">"tree"</span>]]</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co"># get mt ML gene trees</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>mt_ML_genes <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb2-13"><a href="#cb2-13"></a>filenames <span class="ot">=</span> <span class="fu">list.files</span>(<span class="st">"./03_mt_singleGene_ML/"</span>, <span class="at">pattern =</span> <span class="st">"*.contree"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-14"><a href="#cb2-14"></a>mt_ML_genes <span class="ot">=</span> <span class="fu">lapply</span>(filenames, ape<span class="sc">::</span>read.tree)</span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="fu">names</span>(mt_ML_genes) <span class="ot">=</span> <span class="fu">str_remove_all</span>(<span class="fu">str_remove_all</span>(filenames, <span class="st">"./03_mt_singleGene_ML//"</span>), <span class="st">".aln.contree"</span>)</span>
<span id="cb2-16"><a href="#cb2-16"></a>mt_ML_genes[[<span class="st">"cp_mt_ML"</span>]] <span class="ot">=</span> phylogenetic_trees[[<span class="st">"cp_mt_ML"</span>]][[<span class="st">"tree"</span>]]</span>
<span id="cb2-17"><a href="#cb2-17"></a></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co"># create distance lists</span></span>
<span id="cb2-19"><a href="#cb2-19"></a>empty_matrix <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(cp_ML_genes), <span class="at">ncol =</span> <span class="fu">length</span>(cp_ML_genes))</span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="fu">colnames</span>(empty_matrix) <span class="ot">=</span> <span class="fu">names</span>(cp_ML_genes)</span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="fu">rownames</span>(empty_matrix) <span class="ot">=</span> <span class="fu">names</span>(cp_ML_genes)</span>
<span id="cb2-22"><a href="#cb2-22"></a>cp_genes_distances <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"common_nodes_corr"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-23"><a href="#cb2-23"></a>                          <span class="st">"RF"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-24"><a href="#cb2-24"></a>                          <span class="st">"KF"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-25"><a href="#cb2-25"></a>                          <span class="st">"MAST_%"</span> <span class="ot">=</span> empty_matrix)</span>
<span id="cb2-26"><a href="#cb2-26"></a></span>
<span id="cb2-27"><a href="#cb2-27"></a>empty_matrix <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(mt_ML_genes), <span class="at">ncol =</span> <span class="fu">length</span>(mt_ML_genes))</span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="fu">colnames</span>(empty_matrix) <span class="ot">=</span> <span class="fu">names</span>(mt_ML_genes)</span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="fu">rownames</span>(empty_matrix) <span class="ot">=</span> <span class="fu">names</span>(mt_ML_genes)</span>
<span id="cb2-30"><a href="#cb2-30"></a>mt_genes_distances <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"common_nodes_corr"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-31"><a href="#cb2-31"></a>                          <span class="st">"RF"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-32"><a href="#cb2-32"></a>                          <span class="st">"KF"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-33"><a href="#cb2-33"></a>                          <span class="st">"MAST_%"</span> <span class="ot">=</span> empty_matrix)</span>
<span id="cb2-34"><a href="#cb2-34"></a></span>
<span id="cb2-35"><a href="#cb2-35"></a>empty_matrix <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(genes_sets[[<span class="st">"cp_mt_ML"</span>]]), <span class="at">ncol =</span> <span class="fu">length</span>(genes_sets[[<span class="st">"cp_mt_ML"</span>]]))</span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="fu">colnames</span>(empty_matrix) <span class="ot">=</span> <span class="fu">names</span>(genes_sets[[<span class="st">"cp_mt_ML"</span>]])</span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="fu">rownames</span>(empty_matrix) <span class="ot">=</span> <span class="fu">names</span>(genes_sets[[<span class="st">"cp_mt_ML"</span>]])</span>
<span id="cb2-38"><a href="#cb2-38"></a>cp_mt_genes_distances <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"common_nodes_corr"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-39"><a href="#cb2-39"></a>                             <span class="st">"RF"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-40"><a href="#cb2-40"></a>                             <span class="st">"KF"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb2-41"><a href="#cb2-41"></a>                             <span class="st">"MAST_%"</span> <span class="ot">=</span> empty_matrix)</span>
<span id="cb2-42"><a href="#cb2-42"></a></span>
<span id="cb2-43"><a href="#cb2-43"></a></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co"># populate distances lists</span></span>
<span id="cb2-45"><a href="#cb2-45"></a>genes_sets <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_ML"</span> <span class="ot">=</span> cp_ML_genes,</span>
<span id="cb2-46"><a href="#cb2-46"></a>                  <span class="st">"mt_ML"</span> <span class="ot">=</span> mt_ML_genes,</span>
<span id="cb2-47"><a href="#cb2-47"></a>                  <span class="st">"cp_mt_ML"</span> <span class="ot">=</span> <span class="fu">c</span>(cp_ML_genes, mt_ML_genes[<span class="fu">which</span>(<span class="fu">names</span>(mt_ML_genes) <span class="sc">!=</span> <span class="st">"cp_mt_ML"</span>)]))</span>
<span id="cb2-48"><a href="#cb2-48"></a>distance_sets <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_genes_distances"</span> <span class="ot">=</span> cp_genes_distances,</span>
<span id="cb2-49"><a href="#cb2-49"></a>                     <span class="st">"mt_genes_distances"</span> <span class="ot">=</span> mt_genes_distances,</span>
<span id="cb2-50"><a href="#cb2-50"></a>                     <span class="st">"cp_mt_genes_distances"</span> <span class="ot">=</span> cp_mt_genes_distances)</span>
<span id="cb2-51"><a href="#cb2-51"></a></span>
<span id="cb2-52"><a href="#cb2-52"></a><span class="co"># get pairwise distances</span></span>
<span id="cb2-53"><a href="#cb2-53"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distance_sets)){</span>
<span id="cb2-54"><a href="#cb2-54"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(genes_sets[[j]])){</span>
<span id="cb2-55"><a href="#cb2-55"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(genes_sets[[j]])){</span>
<span id="cb2-56"><a href="#cb2-56"></a>      </span>
<span id="cb2-57"><a href="#cb2-57"></a>      <span class="co"># error handling</span></span>
<span id="cb2-58"><a href="#cb2-58"></a>      <span class="co"># MAST call errors for very unresulved trees (e.g.: psaM)</span></span>
<span id="cb2-59"><a href="#cb2-59"></a>      <span class="co">#   Error in root.phylo(x, bipart_x, resolve.root = TRUE) : </span></span>
<span id="cb2-60"><a href="#cb2-60"></a>      <span class="co">#   the specified outgroup is not monophyletic</span></span>
<span id="cb2-61"><a href="#cb2-61"></a>      <span class="co"># catch error and move forward</span></span>
<span id="cb2-62"><a href="#cb2-62"></a>      skip_to_next <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb2-63"><a href="#cb2-63"></a>      </span>
<span id="cb2-64"><a href="#cb2-64"></a>      <span class="co"># get tree</span></span>
<span id="cb2-65"><a href="#cb2-65"></a>      tree1_tmp <span class="ot">=</span> genes_sets[[j]][[i]]</span>
<span id="cb2-66"><a href="#cb2-66"></a>      tree2_tmp <span class="ot">=</span> genes_sets[[j]][[k]]</span>
<span id="cb2-67"><a href="#cb2-67"></a>      </span>
<span id="cb2-68"><a href="#cb2-68"></a>      <span class="co"># list of common species</span></span>
<span id="cb2-69"><a href="#cb2-69"></a>      species_list <span class="ot">=</span> tree1_tmp<span class="sc">$</span>tip.label[<span class="fu">which</span>(tree1_tmp<span class="sc">$</span>tip.label <span class="sc">%in%</span> tree2_tmp<span class="sc">$</span>tip.label)]</span>
<span id="cb2-70"><a href="#cb2-70"></a>      </span>
<span id="cb2-71"><a href="#cb2-71"></a>      <span class="co"># get overlapping species</span></span>
<span id="cb2-72"><a href="#cb2-72"></a>      tree1 <span class="ot">=</span> ape<span class="sc">::</span><span class="fu">keep.tip</span>(tree1_tmp, species_list)</span>
<span id="cb2-73"><a href="#cb2-73"></a>      tree2 <span class="ot">=</span> ape<span class="sc">::</span><span class="fu">keep.tip</span>(tree2_tmp, species_list)</span>
<span id="cb2-74"><a href="#cb2-74"></a>      </span>
<span id="cb2-75"><a href="#cb2-75"></a>      <span class="co"># get distances</span></span>
<span id="cb2-76"><a href="#cb2-76"></a>      distances <span class="ot">=</span> phangorn<span class="sc">::</span><span class="fu">treedist</span>(tree1, tree2)</span>
<span id="cb2-77"><a href="#cb2-77"></a>      distance_sets[[j]][[<span class="st">"RF"</span>]][i, k] <span class="ot">=</span> distances[[<span class="dv">1</span>]]</span>
<span id="cb2-78"><a href="#cb2-78"></a>      distance_sets[[j]][[<span class="st">"KF"</span>]][i, k] <span class="ot">=</span> distances[[<span class="dv">2</span>]]</span>
<span id="cb2-79"><a href="#cb2-79"></a>      <span class="co">#dist_DB_pairwise[["path_diff"]][i, k] = distances[[3]]</span></span>
<span id="cb2-80"><a href="#cb2-80"></a>      distance_sets[[j]][[<span class="st">"MAST_%"</span>]][i, k] <span class="ot">=</span> <span class="fu">tryCatch</span>(<span class="fu">length</span>(phangorn<span class="sc">::</span><span class="fu">mast</span>(tree1, tree2, <span class="at">tree =</span> <span class="cn">FALSE</span>)) <span class="sc">/</span> <span class="fu">length</span>(species_list),</span>
<span id="cb2-81"><a href="#cb2-81"></a>                                                      <span class="at">error =</span> <span class="cf">function</span>(e) { skip_to_next <span class="ot">&lt;&lt;-</span> <span class="cn">TRUE</span> })</span>
<span id="cb2-82"><a href="#cb2-82"></a>      </span>
<span id="cb2-83"><a href="#cb2-83"></a>      <span class="co"># error handling</span></span>
<span id="cb2-84"><a href="#cb2-84"></a>      <span class="cf">if</span>(skip_to_next){distance_sets[[j]][[<span class="st">"MAST_%"</span>]][i, k] <span class="ot">=</span> <span class="cn">NA</span>}</span>
<span id="cb2-85"><a href="#cb2-85"></a>    }</span>
<span id="cb2-86"><a href="#cb2-86"></a>  }</span>
<span id="cb2-87"><a href="#cb2-87"></a>}</span>
<span id="cb2-88"><a href="#cb2-88"></a></span>
<span id="cb2-89"><a href="#cb2-89"></a></span>
<span id="cb2-90"><a href="#cb2-90"></a><span class="do">### get pairwise common_nodes_corr distances</span></span>
<span id="cb2-91"><a href="#cb2-91"></a></span>
<span id="cb2-92"><a href="#cb2-92"></a><span class="co"># create CPU cluster</span></span>
<span id="cb2-93"><a href="#cb2-93"></a>cl <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(<span class="dv">8</span>, <span class="at">type =</span> <span class="st">"SOCK"</span>)</span>
<span id="cb2-94"><a href="#cb2-94"></a><span class="fu">registerDoSNOW</span>(cl)</span>
<span id="cb2-95"><a href="#cb2-95"></a></span>
<span id="cb2-96"><a href="#cb2-96"></a><span class="co"># get chronos in parallel</span></span>
<span id="cb2-97"><a href="#cb2-97"></a>chronos_list <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(genes_sets[[<span class="st">"cp_mt_ML"</span>]]), <span class="at">.combine =</span> <span class="st">"c"</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb2-98"><a href="#cb2-98"></a>  <span class="fu">library</span>(<span class="st">"ape"</span>)</span>
<span id="cb2-99"><a href="#cb2-99"></a>  <span class="co"># get tree</span></span>
<span id="cb2-100"><a href="#cb2-100"></a>  <span class="fu">tryCatch</span>(<span class="fu">chronos</span>(genes_sets[[<span class="st">"cp_mt_ML"</span>]][[k]]), <span class="at">error =</span> <span class="cf">function</span>(e) { <span class="cn">NA</span> })</span>
<span id="cb2-101"><a href="#cb2-101"></a>}  </span>
<span id="cb2-102"><a href="#cb2-102"></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cl)</span>
<span id="cb2-103"><a href="#cb2-103"></a><span class="fu">names</span>(chronos_list) <span class="ot">=</span> <span class="fu">names</span>(genes_sets[[<span class="st">"cp_mt_ML"</span>]])</span>
<span id="cb2-104"><a href="#cb2-104"></a></span>
<span id="cb2-105"><a href="#cb2-105"></a><span class="co"># get pairwise common_nodes_corr distances</span></span>
<span id="cb2-106"><a href="#cb2-106"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distance_sets)){</span>
<span id="cb2-107"><a href="#cb2-107"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(genes_sets[[j]])){</span>
<span id="cb2-108"><a href="#cb2-108"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(genes_sets[[j]])){</span>
<span id="cb2-109"><a href="#cb2-109"></a>      </span>
<span id="cb2-110"><a href="#cb2-110"></a>      <span class="co"># get trees</span></span>
<span id="cb2-111"><a href="#cb2-111"></a>      tree1_tmp <span class="ot">=</span> chronos_list[[<span class="fu">names</span>(genes_sets[[j]])[i]]]</span>
<span id="cb2-112"><a href="#cb2-112"></a>      tree2_tmp <span class="ot">=</span> chronos_list[[<span class="fu">names</span>(genes_sets[[j]])[k]]]</span>
<span id="cb2-113"><a href="#cb2-113"></a>      </span>
<span id="cb2-114"><a href="#cb2-114"></a>      <span class="co"># check trees and get distance</span></span>
<span id="cb2-115"><a href="#cb2-115"></a>      <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(tree1_tmp)) <span class="sc">&amp;</span> <span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(tree2_tmp))){</span>
<span id="cb2-116"><a href="#cb2-116"></a>        distance_sets[[j]][[<span class="st">"common_nodes_corr"</span>]][i, k] <span class="ot">=</span> <span class="fu">cor.dendlist</span>(</span>
<span id="cb2-117"><a href="#cb2-117"></a>          <span class="fu">dendlist</span>(<span class="fu">as.dendrogram</span>(tree1_tmp), <span class="fu">as.dendrogram</span>(tree2_tmp)),</span>
<span id="cb2-118"><a href="#cb2-118"></a>          <span class="at">method =</span> <span class="st">"common_nodes"</span>)[<span class="dv">2</span>]</span>
<span id="cb2-119"><a href="#cb2-119"></a>      } <span class="cf">else</span> {</span>
<span id="cb2-120"><a href="#cb2-120"></a>        distance_sets[[j]][[<span class="st">"common_nodes_corr"</span>]][i, k] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb2-121"><a href="#cb2-121"></a>      }</span>
<span id="cb2-122"><a href="#cb2-122"></a>    }</span>
<span id="cb2-123"><a href="#cb2-123"></a>  }</span>
<span id="cb2-124"><a href="#cb2-124"></a>}</span>
<span id="cb2-125"><a href="#cb2-125"></a></span>
<span id="cb2-126"><a href="#cb2-126"></a></span>
<span id="cb2-127"><a href="#cb2-127"></a><span class="co"># rename matrices for cp/mt overlapping rpl/rps genes (for plotting reasons)</span></span>
<span id="cb2-128"><a href="#cb2-128"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distance_sets[[<span class="st">"mt_genes_distances"</span>]])){</span>
<span id="cb2-129"><a href="#cb2-129"></a>  <span class="fu">rownames</span>(distance_sets[[<span class="st">"mt_genes_distances"</span>]][[i]]) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"atp1"</span>, <span class="st">"atp4"</span>, <span class="st">"atp6"</span>, <span class="st">"atp8"</span>, <span class="st">"atp9"</span>, <span class="st">"cob"</span>, <span class="st">"cox1"</span>, <span class="st">"cox2"</span>, <span class="st">"cox3"</span>, <span class="st">"nad1"</span>, <span class="st">"nad2"</span>,</span>
<span id="cb2-130"><a href="#cb2-130"></a>                                        <span class="st">"nad3"</span>, <span class="st">"nad4"</span>, <span class="st">"nad4L"</span>, <span class="st">"nad5"</span>, <span class="st">"nad6"</span>, <span class="st">"nad7"</span>, <span class="st">"rpl14 "</span>, <span class="st">"rpl16 "</span>, <span class="st">"rpl5 "</span>, <span class="st">"rps10"</span>,</span>
<span id="cb2-131"><a href="#cb2-131"></a>                                        <span class="st">"rps11 "</span>, <span class="st">"rps12 "</span>, <span class="st">"rps13"</span>, <span class="st">"rps14 "</span>, <span class="st">"rps19 "</span>, <span class="st">"rps2 "</span>, <span class="st">"rps3 "</span>, <span class="st">"rps4 "</span>, <span class="st">"cp_mt_ML"</span>)</span>
<span id="cb2-132"><a href="#cb2-132"></a>  <span class="fu">colnames</span>(distance_sets[[<span class="st">"mt_genes_distances"</span>]][[i]]) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"atp1"</span>, <span class="st">"atp4"</span>, <span class="st">"atp6"</span>, <span class="st">"atp8"</span>, <span class="st">"atp9"</span>, <span class="st">"cob"</span>, <span class="st">"cox1"</span>, <span class="st">"cox2"</span>, <span class="st">"cox3"</span>, <span class="st">"nad1"</span>, <span class="st">"nad2"</span>,</span>
<span id="cb2-133"><a href="#cb2-133"></a>                                        <span class="st">"nad3"</span>, <span class="st">"nad4"</span>, <span class="st">"nad4L"</span>, <span class="st">"nad5"</span>, <span class="st">"nad6"</span>, <span class="st">"nad7"</span>, <span class="st">"rpl14 "</span>, <span class="st">"rpl16 "</span>, <span class="st">"rpl5 "</span>, <span class="st">"rps10"</span>,</span>
<span id="cb2-134"><a href="#cb2-134"></a>                                        <span class="st">"rps11 "</span>, <span class="st">"rps12 "</span>, <span class="st">"rps13"</span>, <span class="st">"rps14 "</span>, <span class="st">"rps19 "</span>, <span class="st">"rps2 "</span>, <span class="st">"rps3 "</span>, <span class="st">"rps4 "</span>, <span class="st">"cp_mt_ML"</span>)</span>
<span id="cb2-135"><a href="#cb2-135"></a>}</span>
<span id="cb2-136"><a href="#cb2-136"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distance_sets[[<span class="st">"cp_mt_genes_distances"</span>]])){</span>
<span id="cb2-137"><a href="#cb2-137"></a>  <span class="fu">rownames</span>(distance_sets[[<span class="st">"cp_mt_genes_distances"</span>]][[i]]) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"accD"</span>, <span class="st">"atpA"</span>, <span class="st">"atpB"</span>, <span class="st">"atpE"</span>, <span class="st">"atpF"</span>, <span class="st">"atpH"</span>, <span class="st">"atpI"</span>, <span class="st">"ccsA"</span>, <span class="st">"cemA"</span>, <span class="st">"chlI"</span>, <span class="st">"clpP"</span>,</span>
<span id="cb2-138"><a href="#cb2-138"></a>                                           <span class="st">"infA"</span>, <span class="st">"petA"</span>, <span class="st">"petB"</span>, <span class="st">"petD"</span>, <span class="st">"petG"</span>, <span class="st">"petL"</span>, <span class="st">"psaA"</span>, <span class="st">"psaB"</span>, <span class="st">"psaC"</span>, <span class="st">"psaI"</span>, <span class="st">"psaJ"</span>,</span>
<span id="cb2-139"><a href="#cb2-139"></a>                                           <span class="st">"psaM"</span>, <span class="st">"psbA"</span>, <span class="st">"psbB"</span>, <span class="st">"psbC"</span>, <span class="st">"psbD"</span>, <span class="st">"psbE"</span>, <span class="st">"psbF"</span>, <span class="st">"psbH"</span>, <span class="st">"psbI"</span>, <span class="st">"psbJ"</span>, <span class="st">"psbK"</span>,</span>
<span id="cb2-140"><a href="#cb2-140"></a>                                           <span class="st">"psbL"</span>, <span class="st">"psbM"</span>, <span class="st">"psbN"</span>, <span class="st">"psbT"</span>, <span class="st">"psbZ"</span>, <span class="st">"rbcL"</span>, <span class="st">"rpl12"</span>, <span class="st">"rpl14"</span>, <span class="st">"rpl16"</span>, <span class="st">"rpl19"</span>, <span class="st">"rpl2"</span>,</span>
<span id="cb2-141"><a href="#cb2-141"></a>                                           <span class="st">"rpl20"</span>, <span class="st">"rpl23"</span>, <span class="st">"rpl32"</span>, <span class="st">"rpl36"</span>, <span class="st">"rpl5"</span>, <span class="st">"rpoA"</span>, <span class="st">"rpoB"</span>, <span class="st">"rpoC1"</span>, <span class="st">"rpoC2"</span>, <span class="st">"rps11"</span>,</span>
<span id="cb2-142"><a href="#cb2-142"></a>                                           <span class="st">"rps12"</span>, <span class="st">"rps14"</span>, <span class="st">"rps18"</span>, <span class="st">"rps19"</span>, <span class="st">"rps2"</span>, <span class="st">"rps3"</span>,  <span class="st">"rps4"</span>, <span class="st">"rps7"</span>, <span class="st">"rps8"</span>, <span class="st">"rps9"</span>,</span>
<span id="cb2-143"><a href="#cb2-143"></a>                                           <span class="st">"tufA"</span>, <span class="st">"ycf1"</span>, <span class="st">"ycf12"</span>, <span class="st">"ycf20"</span>, <span class="st">"ycf3"</span>, <span class="st">"ycf4"</span>, <span class="st">"cp_mt_ML"</span>, <span class="st">"atp1"</span>, <span class="st">"atp4"</span>, <span class="st">"atp6"</span>,</span>
<span id="cb2-144"><a href="#cb2-144"></a>                                           <span class="st">"atp8"</span>, <span class="st">"atp9"</span>, <span class="st">"cob"</span>, <span class="st">"cox1"</span>, <span class="st">"cox2"</span>, <span class="st">"cox3"</span>, <span class="st">"nad1"</span>, <span class="st">"nad2"</span>, <span class="st">"nad3"</span>, <span class="st">"nad4"</span>, <span class="st">"nad4L"</span>,</span>
<span id="cb2-145"><a href="#cb2-145"></a>                                           <span class="st">"nad5"</span>, <span class="st">"nad6"</span>, <span class="st">"nad7"</span>, <span class="st">"rpl14 "</span>, <span class="st">"rpl16 "</span>, <span class="st">"rpl5 "</span>, <span class="st">"rps10"</span>, <span class="st">"rps11 "</span>, <span class="st">"rps12 "</span>, <span class="st">"rps13"</span>,</span>
<span id="cb2-146"><a href="#cb2-146"></a>                                           <span class="st">"rps14 "</span>, <span class="st">"rps19 "</span>, <span class="st">"rps2 "</span>, <span class="st">"rps3 "</span>, <span class="st">"rps4 "</span>)</span>
<span id="cb2-147"><a href="#cb2-147"></a>  <span class="fu">colnames</span>(distance_sets[[<span class="st">"cp_mt_genes_distances"</span>]][[i]]) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"accD"</span>, <span class="st">"atpA"</span>, <span class="st">"atpB"</span>, <span class="st">"atpE"</span>, <span class="st">"atpF"</span>, <span class="st">"atpH"</span>, <span class="st">"atpI"</span>, <span class="st">"ccsA"</span>, <span class="st">"cemA"</span>, <span class="st">"chlI"</span>, <span class="st">"clpP"</span>,</span>
<span id="cb2-148"><a href="#cb2-148"></a>                                           <span class="st">"infA"</span>, <span class="st">"petA"</span>, <span class="st">"petB"</span>, <span class="st">"petD"</span>, <span class="st">"petG"</span>, <span class="st">"petL"</span>, <span class="st">"psaA"</span>, <span class="st">"psaB"</span>, <span class="st">"psaC"</span>, <span class="st">"psaI"</span>, <span class="st">"psaJ"</span>,</span>
<span id="cb2-149"><a href="#cb2-149"></a>                                           <span class="st">"psaM"</span>, <span class="st">"psbA"</span>, <span class="st">"psbB"</span>, <span class="st">"psbC"</span>, <span class="st">"psbD"</span>, <span class="st">"psbE"</span>, <span class="st">"psbF"</span>, <span class="st">"psbH"</span>, <span class="st">"psbI"</span>, <span class="st">"psbJ"</span>, <span class="st">"psbK"</span>,</span>
<span id="cb2-150"><a href="#cb2-150"></a>                                           <span class="st">"psbL"</span>, <span class="st">"psbM"</span>, <span class="st">"psbN"</span>, <span class="st">"psbT"</span>, <span class="st">"psbZ"</span>, <span class="st">"rbcL"</span>, <span class="st">"rpl12"</span>, <span class="st">"rpl14"</span>, <span class="st">"rpl16"</span>, <span class="st">"rpl19"</span>, <span class="st">"rpl2"</span>,</span>
<span id="cb2-151"><a href="#cb2-151"></a>                                           <span class="st">"rpl20"</span>, <span class="st">"rpl23"</span>, <span class="st">"rpl32"</span>, <span class="st">"rpl36"</span>, <span class="st">"rpl5"</span>, <span class="st">"rpoA"</span>, <span class="st">"rpoB"</span>, <span class="st">"rpoC1"</span>, <span class="st">"rpoC2"</span>, <span class="st">"rps11"</span>,</span>
<span id="cb2-152"><a href="#cb2-152"></a>                                           <span class="st">"rps12"</span>, <span class="st">"rps14"</span>, <span class="st">"rps18"</span>, <span class="st">"rps19"</span>, <span class="st">"rps2"</span>, <span class="st">"rps3"</span>,  <span class="st">"rps4"</span>, <span class="st">"rps7"</span>, <span class="st">"rps8"</span>, <span class="st">"rps9"</span>,</span>
<span id="cb2-153"><a href="#cb2-153"></a>                                           <span class="st">"tufA"</span>, <span class="st">"ycf1"</span>, <span class="st">"ycf12"</span>, <span class="st">"ycf20"</span>, <span class="st">"ycf3"</span>, <span class="st">"ycf4"</span>, <span class="st">"cp_mt_ML"</span>, <span class="st">"atp1"</span>, <span class="st">"atp4"</span>, <span class="st">"atp6"</span>,</span>
<span id="cb2-154"><a href="#cb2-154"></a>                                           <span class="st">"atp8"</span>, <span class="st">"atp9"</span>, <span class="st">"cob"</span>, <span class="st">"cox1"</span>, <span class="st">"cox2"</span>, <span class="st">"cox3"</span>, <span class="st">"nad1"</span>, <span class="st">"nad2"</span>, <span class="st">"nad3"</span>, <span class="st">"nad4"</span>, <span class="st">"nad4L"</span>,</span>
<span id="cb2-155"><a href="#cb2-155"></a>                                           <span class="st">"nad5"</span>, <span class="st">"nad6"</span>, <span class="st">"nad7"</span>, <span class="st">"rpl14 "</span>, <span class="st">"rpl16 "</span>, <span class="st">"rpl5 "</span>, <span class="st">"rps10"</span>, <span class="st">"rps11 "</span>, <span class="st">"rps12 "</span>, <span class="st">"rps13"</span>,</span>
<span id="cb2-156"><a href="#cb2-156"></a>                                           <span class="st">"rps14 "</span>, <span class="st">"rps19 "</span>, <span class="st">"rps2 "</span>, <span class="st">"rps3 "</span>, <span class="st">"rps4 "</span>)</span>
<span id="cb2-157"><a href="#cb2-157"></a>}</span>
<span id="cb2-158"><a href="#cb2-158"></a></span>
<span id="cb2-159"><a href="#cb2-159"></a><span class="do">### plot heatmaps of distances</span></span>
<span id="cb2-160"><a href="#cb2-160"></a><span class="co"># prepare gene lists</span></span>
<span id="cb2-161"><a href="#cb2-161"></a>cp_genes_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"accD"</span>, <span class="st">"atpA"</span>, <span class="st">"atpB"</span>, <span class="st">"atpE"</span>, <span class="st">"atpF"</span>, <span class="st">"atpH"</span>, <span class="st">"atpI"</span>, <span class="st">"ccsA"</span>, <span class="st">"cemA"</span>, <span class="st">"chlI"</span>, <span class="st">"clpP"</span>,</span>
<span id="cb2-162"><a href="#cb2-162"></a>                  <span class="st">"infA"</span>, <span class="st">"petA"</span>, <span class="st">"petB"</span>, <span class="st">"petD"</span>, <span class="st">"petG"</span>, <span class="st">"petL"</span>, <span class="st">"psaA"</span>, <span class="st">"psaB"</span>, <span class="st">"psaC"</span>, <span class="st">"psaI"</span>, <span class="st">"psaJ"</span>,</span>
<span id="cb2-163"><a href="#cb2-163"></a>                  <span class="st">"psaM"</span>, <span class="st">"psbA"</span>, <span class="st">"psbB"</span>, <span class="st">"psbC"</span>, <span class="st">"psbD"</span>, <span class="st">"psbE"</span>, <span class="st">"psbF"</span>, <span class="st">"psbH"</span>, <span class="st">"psbI"</span>, <span class="st">"psbJ"</span>, <span class="st">"psbK"</span>,</span>
<span id="cb2-164"><a href="#cb2-164"></a>                  <span class="st">"psbL"</span>, <span class="st">"psbM"</span>, <span class="st">"psbN"</span>, <span class="st">"psbT"</span>, <span class="st">"psbZ"</span>, <span class="st">"rbcL"</span>, <span class="st">"rpl12"</span>, <span class="st">"rpl14"</span>, <span class="st">"rpl16"</span>, <span class="st">"rpl19"</span>, <span class="st">"rpl2"</span>,</span>
<span id="cb2-165"><a href="#cb2-165"></a>                  <span class="st">"rpl20"</span>, <span class="st">"rpl23"</span>, <span class="st">"rpl32"</span>, <span class="st">"rpl36"</span>, <span class="st">"rpl5"</span>, <span class="st">"rpoA"</span>, <span class="st">"rpoB"</span>, <span class="st">"rpoC1"</span>, <span class="st">"rpoC2"</span>, <span class="st">"rps11"</span>,</span>
<span id="cb2-166"><a href="#cb2-166"></a>                  <span class="st">"rps12"</span>, <span class="st">"rps14"</span>, <span class="st">"rps18"</span>, <span class="st">"rps19"</span>, <span class="st">"rps2"</span>, <span class="st">"rps3"</span>,  <span class="st">"rps4"</span>, <span class="st">"rps7"</span>, <span class="st">"rps8"</span>, <span class="st">"rps9"</span>,</span>
<span id="cb2-167"><a href="#cb2-167"></a>                  <span class="st">"tufA"</span>, <span class="st">"ycf1"</span>, <span class="st">"ycf12"</span>, <span class="st">"ycf20"</span>, <span class="st">"ycf3"</span>, <span class="st">"ycf4"</span>)</span>
<span id="cb2-168"><a href="#cb2-168"></a>mt_genes_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"atp1"</span>, <span class="st">"atp4"</span>, <span class="st">"atp6"</span>, <span class="st">"atp8"</span>, <span class="st">"atp9"</span>, <span class="st">"cob"</span>, <span class="st">"cox1"</span>, <span class="st">"cox2"</span>, <span class="st">"cox3"</span>, <span class="st">"nad1"</span>, <span class="st">"nad2"</span>,</span>
<span id="cb2-169"><a href="#cb2-169"></a>                  <span class="st">"nad3"</span>, <span class="st">"nad4"</span>, <span class="st">"nad4L"</span>, <span class="st">"nad5"</span>, <span class="st">"nad6"</span>, <span class="st">"nad7"</span>, <span class="st">"rpl14 "</span>, <span class="st">"rpl16 "</span>, <span class="st">"rpl5 "</span>, <span class="st">"rps10"</span>,</span>
<span id="cb2-170"><a href="#cb2-170"></a>                  <span class="st">"rps11 "</span>, <span class="st">"rps12 "</span>, <span class="st">"rps13"</span>, <span class="st">"rps14 "</span>, <span class="st">"rps19 "</span>, <span class="st">"rps2 "</span>, <span class="st">"rps3 "</span>, <span class="st">"rps4 "</span>)</span>
<span id="cb2-171"><a href="#cb2-171"></a></span>
<span id="cb2-172"><a href="#cb2-172"></a><span class="co"># prepare plot lists</span></span>
<span id="cb2-173"><a href="#cb2-173"></a>distances_plots <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp"</span> <span class="ot">=</span> <span class="fu">list</span>(), <span class="st">"mt"</span> <span class="ot">=</span> <span class="fu">list</span>(), <span class="st">"cp_mt"</span> <span class="ot">=</span> <span class="fu">list</span>())</span>
<span id="cb2-174"><a href="#cb2-174"></a></span>
<span id="cb2-175"><a href="#cb2-175"></a><span class="co"># iterate plots</span></span>
<span id="cb2-176"><a href="#cb2-176"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distance_sets)){</span>
<span id="cb2-177"><a href="#cb2-177"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distance_sets[[i]])){</span>
<span id="cb2-178"><a href="#cb2-178"></a>    </span>
<span id="cb2-179"><a href="#cb2-179"></a>    <span class="co"># remove possible rows/columns with only NAs</span></span>
<span id="cb2-180"><a href="#cb2-180"></a>    tmp_matrix <span class="ot">=</span> distance_sets[[i]][[k]]</span>
<span id="cb2-181"><a href="#cb2-181"></a>    tmp_matrix <span class="ot">=</span> tmp_matrix[, <span class="fu">colSums</span>(<span class="fu">is.na</span>(tmp_matrix)) <span class="sc">&lt;</span> <span class="fu">nrow</span>(tmp_matrix)]</span>
<span id="cb2-182"><a href="#cb2-182"></a>    tmp_matrix <span class="ot">=</span> tmp_matrix[<span class="fu">rowSums</span>(<span class="fu">is.na</span>(tmp_matrix)) <span class="sc">&lt;</span> <span class="fu">ncol</span>(tmp_matrix), ]</span>
<span id="cb2-183"><a href="#cb2-183"></a>    </span>
<span id="cb2-184"><a href="#cb2-184"></a>    <span class="co"># get names</span></span>
<span id="cb2-185"><a href="#cb2-185"></a>    plot_name <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">names</span>(distance_sets[[i]])[[k]] <span class="sc">==</span> <span class="st">"common_nodes_corr"</span>, <span class="st">"common</span><span class="sc">\n</span><span class="st">nodes</span><span class="sc">\n</span><span class="st">corr"</span>, <span class="fu">names</span>(distance_sets[[i]])[[k]])</span>
<span id="cb2-186"><a href="#cb2-186"></a>    </span>
<span id="cb2-187"><a href="#cb2-187"></a>    <span class="co"># prep annotation</span></span>
<span id="cb2-188"><a href="#cb2-188"></a>    organell <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">ifelse</span>(<span class="fu">rownames</span>(tmp_matrix) <span class="sc">%in%</span> cp_genes_list, <span class="st">"cp"</span>,</span>
<span id="cb2-189"><a href="#cb2-189"></a>                                    <span class="fu">ifelse</span>(<span class="fu">rownames</span>(tmp_matrix) <span class="sc">%in%</span> mt_genes_list, <span class="st">"mt"</span>, <span class="st">"cp_mt"</span>)))</span>
<span id="cb2-190"><a href="#cb2-190"></a>    <span class="fu">rownames</span>(organell) <span class="ot">=</span> <span class="fu">rownames</span>(tmp_matrix)</span>
<span id="cb2-191"><a href="#cb2-191"></a>    <span class="fu">colnames</span>(organell) <span class="ot">=</span> <span class="st">"organell"</span></span>
<span id="cb2-192"><a href="#cb2-192"></a>    organell<span class="sc">$</span>color <span class="ot">=</span> <span class="fu">ifelse</span>(organell<span class="sc">$</span>organell <span class="sc">==</span> <span class="st">"cp"</span>, <span class="st">"#469d89"</span>, <span class="fu">ifelse</span>(organell<span class="sc">$</span>organell <span class="sc">==</span> <span class="st">"mt"</span>, <span class="st">"steelblue"</span>, <span class="st">"red"</span>))</span>
<span id="cb2-193"><a href="#cb2-193"></a>    </span>
<span id="cb2-194"><a href="#cb2-194"></a>    <span class="co"># plot raw distance</span></span>
<span id="cb2-195"><a href="#cb2-195"></a>    distances_plots[[i]][[k]] <span class="ot">=</span> <span class="fu">grid.grabExpr</span>(<span class="fu">draw</span>(ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(tmp_matrix,</span>
<span id="cb2-196"><a href="#cb2-196"></a>                                                                           <span class="at">col =</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="fu">min</span>(tmp_matrix[<span class="sc">!</span><span class="fu">is.na</span>(tmp_matrix)]),</span>
<span id="cb2-197"><a href="#cb2-197"></a>                                                                                              <span class="fu">max</span>(tmp_matrix[<span class="sc">!</span><span class="fu">is.na</span>(tmp_matrix)])),</span>
<span id="cb2-198"><a href="#cb2-198"></a>                                                                                            <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"#D55E00"</span>)),</span>
<span id="cb2-199"><a href="#cb2-199"></a>                                                                           <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> organell<span class="sc">$</span>color),</span>
<span id="cb2-200"><a href="#cb2-200"></a>                                                                           <span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> organell<span class="sc">$</span>color),</span>
<span id="cb2-201"><a href="#cb2-201"></a>                                                                           <span class="at">top_annotation =</span> <span class="fu">HeatmapAnnotation</span>(<span class="at">organell =</span> <span class="fu">as.matrix</span>(organell<span class="sc">$</span>organell),</span>
<span id="cb2-202"><a href="#cb2-202"></a>                                                                                                              <span class="at">show_annotation_name =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-203"><a href="#cb2-203"></a>                                                                                                              <span class="at">show_legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-204"><a href="#cb2-204"></a>                                                                                                              <span class="at">col =</span> <span class="fu">list</span>(<span class="at">organell =</span> <span class="fu">c</span>(<span class="st">"cp_mt"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"cp"</span> <span class="ot">=</span> <span class="st">"#469d89"</span>, <span class="st">"mt"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>))),</span>
<span id="cb2-205"><a href="#cb2-205"></a>                                                                           <span class="at">left_annotation =</span> <span class="fu">rowAnnotation</span>(<span class="at">organell =</span> <span class="fu">as.matrix</span>(organell<span class="sc">$</span>organell),</span>
<span id="cb2-206"><a href="#cb2-206"></a>                                                                                                           <span class="at">show_annotation_name =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-207"><a href="#cb2-207"></a>                                                                                                           <span class="at">col =</span> <span class="fu">list</span>(<span class="at">organell =</span> <span class="fu">c</span>(<span class="st">"cp_mt"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"cp"</span> <span class="ot">=</span> <span class="st">"#469d89"</span>, <span class="st">"mt"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>))),</span>
<span id="cb2-208"><a href="#cb2-208"></a>                                                                           <span class="at">name =</span> plot_name)))</span>
<span id="cb2-209"><a href="#cb2-209"></a>    <span class="fu">grid.newpage</span>(<span class="at">recording =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-210"><a href="#cb2-210"></a>    <span class="fu">grid.draw</span>(distances_plots[[i]][[k]])</span>
<span id="cb2-211"><a href="#cb2-211"></a></span>
<span id="cb2-212"><a href="#cb2-212"></a>    <span class="co"># normalize</span></span>
<span id="cb2-213"><a href="#cb2-213"></a>    normalized <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">scale</span>(<span class="fu">t</span>(tmp_matrix)))</span>
<span id="cb2-214"><a href="#cb2-214"></a>    <span class="co"># plot normalized distances</span></span>
<span id="cb2-215"><a href="#cb2-215"></a>    distances_plots[[i]][[k <span class="sc">+</span> <span class="dv">4</span>]] <span class="ot">=</span> <span class="fu">grid.grabExpr</span>(<span class="fu">draw</span>(ComplexHeatmap<span class="sc">::</span><span class="fu">Heatmap</span>(normalized,</span>
<span id="cb2-216"><a href="#cb2-216"></a>                                                                               <span class="at">col =</span> <span class="fu">colorRamp2</span>(<span class="fu">c</span>(<span class="fu">min</span>(normalized[<span class="sc">!</span><span class="fu">is.na</span>(normalized)]), <span class="dv">0</span>, <span class="fu">max</span>(normalized[<span class="sc">!</span><span class="fu">is.na</span>(normalized)])),</span>
<span id="cb2-217"><a href="#cb2-217"></a>                                                                                                <span class="fu">c</span>(<span class="st">"#56B4E9"</span>, <span class="st">"white"</span>, <span class="st">"#D55E00"</span>)),</span>
<span id="cb2-218"><a href="#cb2-218"></a>                                                                               <span class="at">row_names_gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> organell<span class="sc">$</span>color),</span>
<span id="cb2-219"><a href="#cb2-219"></a>                                                                               <span class="at">column_names_gp =</span> <span class="fu">gpar</span>(<span class="at">col =</span> organell<span class="sc">$</span>color),</span>
<span id="cb2-220"><a href="#cb2-220"></a>                                                                               <span class="at">top_annotation =</span> <span class="fu">HeatmapAnnotation</span>(<span class="at">organell =</span> <span class="fu">as.matrix</span>(organell<span class="sc">$</span>organell),</span>
<span id="cb2-221"><a href="#cb2-221"></a>                                                                                                                  <span class="at">show_annotation_name =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-222"><a href="#cb2-222"></a>                                                                                                                  <span class="at">show_legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-223"><a href="#cb2-223"></a>                                                                                                                  <span class="at">col =</span> <span class="fu">list</span>(<span class="at">organell =</span> <span class="fu">c</span>(<span class="st">"cp_mt"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"cp"</span> <span class="ot">=</span> <span class="st">"#469d89"</span>, <span class="st">"mt"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>))),</span>
<span id="cb2-224"><a href="#cb2-224"></a>                                                                               <span class="at">left_annotation =</span> <span class="fu">rowAnnotation</span>(<span class="at">organell =</span> <span class="fu">as.matrix</span>(organell<span class="sc">$</span>organell),</span>
<span id="cb2-225"><a href="#cb2-225"></a>                                                                                                               <span class="at">show_annotation_name =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-226"><a href="#cb2-226"></a>                                                                                                               <span class="at">col =</span> <span class="fu">list</span>(<span class="at">organell =</span> <span class="fu">c</span>(<span class="st">"cp_mt"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"cp"</span> <span class="ot">=</span> <span class="st">"#469d89"</span>, <span class="st">"mt"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>))),</span>
<span id="cb2-227"><a href="#cb2-227"></a>                                                                               <span class="at">name =</span> <span class="fu">paste</span>(plot_name, <span class="st">"</span><span class="sc">\n</span><span class="st">z-score"</span>, <span class="at">sep =</span> <span class="st">""</span>))))</span>
<span id="cb2-228"><a href="#cb2-228"></a>    <span class="fu">grid.newpage</span>(<span class="at">recording =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-229"><a href="#cb2-229"></a>    <span class="fu">grid.draw</span>(distances_plots[[i]][[k <span class="sc">+</span> <span class="dv">4</span>]])</span>
<span id="cb2-230"><a href="#cb2-230"></a>  }</span>
<span id="cb2-231"><a href="#cb2-231"></a>}</span>
<span id="cb2-232"><a href="#cb2-232"></a></span>
<span id="cb2-233"><a href="#cb2-233"></a><span class="co"># composite plots</span></span>
<span id="cb2-234"><a href="#cb2-234"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distances_plots)){</span>
<span id="cb2-235"><a href="#cb2-235"></a>  <span class="fu">grid.arrange</span>(distances_plots[[i]][[<span class="dv">1</span>]], distances_plots[[i]][[<span class="dv">2</span>]],</span>
<span id="cb2-236"><a href="#cb2-236"></a>               distances_plots[[i]][[<span class="dv">3</span>]], distances_plots[[i]][[<span class="dv">4</span>]],</span>
<span id="cb2-237"><a href="#cb2-237"></a>               <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb2-238"><a href="#cb2-238"></a>               <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="fu">paste</span>(<span class="fu">names</span>(distances_plots)[i], <span class="st">" raw distance"</span>, <span class="at">sep =</span> <span class="st">""</span>)))</span>
<span id="cb2-239"><a href="#cb2-239"></a>  <span class="fu">grid.arrange</span>(distances_plots[[i]][[<span class="dv">5</span>]], distances_plots[[i]][[<span class="dv">6</span>]],</span>
<span id="cb2-240"><a href="#cb2-240"></a>               distances_plots[[i]][[<span class="dv">7</span>]], distances_plots[[i]][[<span class="dv">8</span>]],</span>
<span id="cb2-241"><a href="#cb2-241"></a>               <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb2-242"><a href="#cb2-242"></a>               <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="fu">paste</span>(<span class="fu">names</span>(distances_plots)[i], <span class="st">" normalized distance"</span>, <span class="at">sep =</span> <span class="st">""</span>)))</span>
<span id="cb2-243"><a href="#cb2-243"></a>  <span class="fu">grid.arrange</span>(distances_plots[[i]][[<span class="dv">1</span>]], distances_plots[[i]][[<span class="dv">2</span>]], distances_plots[[i]][[<span class="dv">3</span>]], distances_plots[[i]][[<span class="dv">4</span>]],</span>
<span id="cb2-244"><a href="#cb2-244"></a>               distances_plots[[i]][[<span class="dv">5</span>]], distances_plots[[i]][[<span class="dv">6</span>]], distances_plots[[i]][[<span class="dv">7</span>]], distances_plots[[i]][[<span class="dv">8</span>]],</span>
<span id="cb2-245"><a href="#cb2-245"></a>               <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb2-246"><a href="#cb2-246"></a>               <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="fu">paste</span>(<span class="fu">names</span>(distances_plots)[i], <span class="st">" raw and normalized distance"</span>, <span class="at">sep =</span> <span class="st">""</span>)))</span>
<span id="cb2-247"><a href="#cb2-247"></a>}</span>
<span id="cb2-248"><a href="#cb2-248"></a></span>
<span id="cb2-249"><a href="#cb2-249"></a><span class="co"># export tables</span></span>
<span id="cb2-250"><a href="#cb2-250"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distance_sets)){</span>
<span id="cb2-251"><a href="#cb2-251"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(distance_sets[[i]])){</span>
<span id="cb2-252"><a href="#cb2-252"></a>    <span class="fu">write.table</span>(distance_sets[[i]][[k]],</span>
<span id="cb2-253"><a href="#cb2-253"></a>                <span class="at">file =</span> <span class="fu">paste</span>(<span class="st">"./08_genes_distances/"</span>, <span class="fu">names</span>(distance_sets)[i], <span class="st">".distances."</span>, <span class="fu">names</span>(distance_sets[[i]])[k], <span class="st">".txt"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb2-254"><a href="#cb2-254"></a>                <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-255"><a href="#cb2-255"></a>  }</span>
<span id="cb2-256"><a href="#cb2-256"></a>}</span>
<span id="cb2-257"><a href="#cb2-257"></a></span>
<span id="cb2-258"><a href="#cb2-258"></a><span class="co"># clean up</span></span>
<span id="cb2-259"><a href="#cb2-259"></a>cp_genes_distances <span class="ot">=</span> distance_sets[[<span class="st">"cp_genes_distances"</span>]]</span>
<span id="cb2-260"><a href="#cb2-260"></a>mt_genes_distances <span class="ot">=</span> distance_sets[[<span class="st">"mt_genes_distances"</span>]]</span>
<span id="cb2-261"><a href="#cb2-261"></a>cp_mt_genes_distances <span class="ot">=</span> distance_sets[[<span class="st">"cp_mt_genes_distances"</span>]]</span>
<span id="cb2-262"><a href="#cb2-262"></a><span class="fu">rm</span>(tree1_tmp, tree2_tmp, tree1, tree2, species_list, distances,</span>
<span id="cb2-263"><a href="#cb2-263"></a>   distance_sets, chronos_list, plot_name, tmp_matrix, genes_sets, skip_to_next)</span>
<span id="cb2-264"><a href="#cb2-264"></a></span>
<span id="cb2-265"><a href="#cb2-265"></a><span class="co"># close the pdf file</span></span>
<span id="cb2-266"><a href="#cb2-266"></a><span class="fu">dev.off</span>()</span>
<span id="cb2-267"><a href="#cb2-267"></a></span>
<span id="cb2-268"><a href="#cb2-268"></a><span class="co"># export distance tables</span></span>
<span id="cb2-269"><a href="#cb2-269"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cp_genes_distances)){</span>
<span id="cb2-270"><a href="#cb2-270"></a>  <span class="fu">write.table</span>(cp_genes_distances[[i]],</span>
<span id="cb2-271"><a href="#cb2-271"></a>              <span class="at">file =</span> <span class="fu">paste</span>(<span class="st">"UlvaOmics."</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>), <span class="st">".04_Single_genes_stats.cp."</span>, <span class="fu">names</span>(cp_genes_distances)[i], <span class="st">".txt"</span>,  <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb2-272"><a href="#cb2-272"></a>              <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-273"><a href="#cb2-273"></a>}</span>
<span id="cb2-274"><a href="#cb2-274"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mt_genes_distances)){</span>
<span id="cb2-275"><a href="#cb2-275"></a>  <span class="fu">write.table</span>(mt_genes_distances[[i]],</span>
<span id="cb2-276"><a href="#cb2-276"></a>              <span class="at">file =</span> <span class="fu">paste</span>(<span class="st">"UlvaOmics."</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>), <span class="st">".04_Single_genes_stats.mt."</span>, <span class="fu">names</span>(mt_genes_distances)[i], <span class="st">".txt"</span>,  <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb2-277"><a href="#cb2-277"></a>              <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-278"><a href="#cb2-278"></a>}</span>
<span id="cb2-279"><a href="#cb2-279"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cp_mt_genes_distances)){</span>
<span id="cb2-280"><a href="#cb2-280"></a>  <span class="fu">write.table</span>(cp_mt_genes_distances[[i]],</span>
<span id="cb2-281"><a href="#cb2-281"></a>              <span class="at">file =</span> <span class="fu">paste</span>(<span class="st">"UlvaOmics."</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>), <span class="st">".04_Single_genes_stats.cp_mt."</span>, <span class="fu">names</span>(cp_mt_genes_distances)[i], <span class="st">".txt"</span>,  <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb2-282"><a href="#cb2-282"></a>              <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-283"><a href="#cb2-283"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="markers-selection" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="markers-selection"><span class="header-section-number">3.3</span> Markers selection</h2>
<p>We use a combinatorial approach to select the minimum list of genes to approxima te the CP+MT species three</p>
<section id="cp-only" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="cp-only"><span class="header-section-number">3.3.1</span> cp only</h3>
<p>ss</p>
</section>
<section id="mt-only" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="mt-only"><span class="header-section-number">3.3.2</span> mt only</h3>
<p>ss</p>
</section>
<section id="cp-mt" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="cp-mt"><span class="header-section-number">3.3.3</span> cp + mt</h3>
<p>ss</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># declare gene lists</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>cp_genes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"petB"</span>, <span class="st">"psaA"</span>, <span class="st">"psaB"</span>, <span class="st">"psbB"</span>, <span class="st">"psbD"</span>, <span class="st">"rps2"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>mt_genes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"atp6"</span>, <span class="st">"cox1"</span>, <span class="st">"cox2"</span>, <span class="st">"rps3"</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># import ref species tree</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>cp_mt_ML_dendro <span class="ot">=</span> ape<span class="sc">::</span><span class="fu">read.tree</span>(<span class="at">file =</span> <span class="st">"06_cp_mt_concat_ML/cp_mt_allgenes_concat.contree"</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co"># create empty list of trees</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>combinatorial_trees <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_conc_2_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro),</span>
<span id="cb3-10"><a href="#cb3-10"></a>                           <span class="st">"cp_mt_conc_3_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro),</span>
<span id="cb3-11"><a href="#cb3-11"></a>                           <span class="st">"cp_mt_conc_4_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro),</span>
<span id="cb3-12"><a href="#cb3-12"></a>                           <span class="st">"cp_mt_conc_5_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro),</span>
<span id="cb3-13"><a href="#cb3-13"></a>                           <span class="st">"cp_mt_conc_6_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro),</span>
<span id="cb3-14"><a href="#cb3-14"></a>                           <span class="st">"cp_mt_conc_7_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro),</span>
<span id="cb3-15"><a href="#cb3-15"></a>                           <span class="st">"cp_mt_conc_8_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro),</span>
<span id="cb3-16"><a href="#cb3-16"></a>                           <span class="st">"cp_mt_conc_9_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro),</span>
<span id="cb3-17"><a href="#cb3-17"></a>                           <span class="st">"cp_mt_conc_10_genes"</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_ML"</span> <span class="ot">=</span> cp_mt_ML_dendro))</span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co"># populate combinatorial trees</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb3-21"><a href="#cb3-21"></a>  </span>
<span id="cb3-22"><a href="#cb3-22"></a>  <span class="co"># get file list</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>  tree_list_all <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">paste</span>(mainDir, <span class="st">"/09_combinatorial_phylogeny/01_cp_mt_combinatorial/cp_mt_conc_"</span>, k, <span class="st">"_genes"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb3-24"><a href="#cb3-24"></a>                             <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.contree$"</span>)</span>
<span id="cb3-25"><a href="#cb3-25"></a>  <span class="co"># keep only trees with both cp and mt markers</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>  tree_list_fltr <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb3-27"><a href="#cb3-27"></a>  <span class="cf">for</span>(tree <span class="cf">in</span> tree_list_all){</span>
<span id="cb3-28"><a href="#cb3-28"></a>    cp <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>    mt <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb3-30"><a href="#cb3-30"></a>    <span class="co"># check if cp is present</span></span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="cf">for</span>(gene <span class="cf">in</span> cp_genes){</span>
<span id="cb3-32"><a href="#cb3-32"></a>      <span class="cf">if</span>(<span class="fu">grepl</span>(gene, tree, <span class="at">fixed =</span> <span class="cn">TRUE</span>)){</span>
<span id="cb3-33"><a href="#cb3-33"></a>        cp <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>      }</span>
<span id="cb3-35"><a href="#cb3-35"></a>    }</span>
<span id="cb3-36"><a href="#cb3-36"></a>    <span class="co"># check if mt is present</span></span>
<span id="cb3-37"><a href="#cb3-37"></a>    <span class="cf">for</span>(gene <span class="cf">in</span> mt_genes){</span>
<span id="cb3-38"><a href="#cb3-38"></a>      <span class="cf">if</span>(<span class="fu">grepl</span>(gene, tree, <span class="at">fixed =</span> <span class="cn">TRUE</span>)){</span>
<span id="cb3-39"><a href="#cb3-39"></a>        mt <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb3-40"><a href="#cb3-40"></a>      }</span>
<span id="cb3-41"><a href="#cb3-41"></a>    }</span>
<span id="cb3-42"><a href="#cb3-42"></a>    <span class="cf">if</span>(cp <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> mt <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb3-43"><a href="#cb3-43"></a>      tree_list_fltr <span class="ot">=</span> <span class="fu">c</span>(tree_list_fltr, tree)</span>
<span id="cb3-44"><a href="#cb3-44"></a>    }</span>
<span id="cb3-45"><a href="#cb3-45"></a>  }</span>
<span id="cb3-46"><a href="#cb3-46"></a>  </span>
<span id="cb3-47"><a href="#cb3-47"></a>  <span class="co"># import trees</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>  <span class="cf">for</span>(tree <span class="cf">in</span> tree_list_fltr){</span>
<span id="cb3-49"><a href="#cb3-49"></a>    combinatorial_trees[[<span class="fu">paste</span>(<span class="st">"cp_mt_conc_"</span>, k, <span class="st">"_genes"</span>, <span class="at">sep =</span> <span class="st">""</span>)]][[<span class="fu">length</span>(combinatorial_trees[[<span class="fu">paste</span>(<span class="st">"cp_mt_conc_"</span>, k, <span class="st">"_genes"</span>, <span class="at">sep =</span> <span class="st">""</span>)]]) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">=</span> ape<span class="sc">::</span><span class="fu">read.tree</span>(<span class="at">file =</span> <span class="fu">paste</span>(mainDir, <span class="st">"/09_combinatorial_phylogeny/01_cp_mt_combinatorial/cp_mt_conc_"</span>, k, <span class="st">"_genes/"</span>, tree, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb3-50"><a href="#cb3-50"></a>    <span class="fu">names</span>(combinatorial_trees[[<span class="fu">paste</span>(<span class="st">"cp_mt_conc_"</span>, k, <span class="st">"_genes"</span>, <span class="at">sep =</span> <span class="st">""</span>)]])[[<span class="fu">length</span>(combinatorial_trees[[<span class="fu">paste</span>(<span class="st">"cp_mt_conc_"</span>, k, <span class="st">"_genes"</span>, <span class="at">sep =</span> <span class="st">""</span>)]])]] <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(tree, <span class="st">".aln.contree"</span>)</span>
<span id="cb3-51"><a href="#cb3-51"></a>  }</span>
<span id="cb3-52"><a href="#cb3-52"></a>  </span>
<span id="cb3-53"><a href="#cb3-53"></a>  <span class="co"># clean</span></span>
<span id="cb3-54"><a href="#cb3-54"></a>  <span class="fu">rm</span>(cp, gene, k, mt, tree, tree_list_all, tree_list_fltr)</span>
<span id="cb3-55"><a href="#cb3-55"></a>}</span>
<span id="cb3-56"><a href="#cb3-56"></a></span>
<span id="cb3-57"><a href="#cb3-57"></a></span>
<span id="cb3-58"><a href="#cb3-58"></a></span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="co">#------------------------------------------------------------------------------#</span></span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="do">## 2.2 - Get distance matrices                                              ####</span></span>
<span id="cb3-61"><a href="#cb3-61"></a></span>
<span id="cb3-62"><a href="#cb3-62"></a><span class="co"># create distance lists</span></span>
<span id="cb3-63"><a href="#cb3-63"></a>combinatorial_distances <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"cp_mt_conc_2_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-64"><a href="#cb3-64"></a>                               <span class="st">"cp_mt_conc_3_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-65"><a href="#cb3-65"></a>                               <span class="st">"cp_mt_conc_4_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-66"><a href="#cb3-66"></a>                               <span class="st">"cp_mt_conc_5_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-67"><a href="#cb3-67"></a>                               <span class="st">"cp_mt_conc_6_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-68"><a href="#cb3-68"></a>                               <span class="st">"cp_mt_conc_7_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-69"><a href="#cb3-69"></a>                               <span class="st">"cp_mt_conc_8_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-70"><a href="#cb3-70"></a>                               <span class="st">"cp_mt_conc_9_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-71"><a href="#cb3-71"></a>                               <span class="st">"cp_mt_conc_10_genes"</span> <span class="ot">=</span> <span class="cn">NULL</span>)</span>
<span id="cb3-72"><a href="#cb3-72"></a></span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="co"># populate distance lists</span></span>
<span id="cb3-74"><a href="#cb3-74"></a>combinatorial_list <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">97</span>, <span class="dv">195</span>, <span class="dv">247</span>, <span class="dv">210</span>, <span class="dv">121</span>, <span class="dv">46</span>, <span class="dv">11</span>, <span class="dv">2</span>)</span>
<span id="cb3-75"><a href="#cb3-75"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_distances)){</span>
<span id="cb3-76"><a href="#cb3-76"></a>  </span>
<span id="cb3-77"><a href="#cb3-77"></a>  <span class="co"># get size of the results matrix</span></span>
<span id="cb3-78"><a href="#cb3-78"></a>  empty_matrix <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> combinatorial_list[[k]],</span>
<span id="cb3-79"><a href="#cb3-79"></a>                        <span class="at">ncol =</span> combinatorial_list[[k]])</span>
<span id="cb3-80"><a href="#cb3-80"></a>  <span class="fu">colnames</span>(empty_matrix) <span class="ot">=</span> <span class="fu">names</span>(combinatorial_trees[[k]])</span>
<span id="cb3-81"><a href="#cb3-81"></a>  <span class="fu">rownames</span>(empty_matrix) <span class="ot">=</span> <span class="fu">names</span>(combinatorial_trees[[k]])</span>
<span id="cb3-82"><a href="#cb3-82"></a>  </span>
<span id="cb3-83"><a href="#cb3-83"></a>  <span class="co"># populate</span></span>
<span id="cb3-84"><a href="#cb3-84"></a>  combinatorial_distances[[k]] <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"common_nodes_corr"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb3-85"><a href="#cb3-85"></a>                                      <span class="st">"RF"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb3-86"><a href="#cb3-86"></a>                                      <span class="st">"KF"</span> <span class="ot">=</span> empty_matrix,</span>
<span id="cb3-87"><a href="#cb3-87"></a>                                      <span class="st">"MAST_%"</span> <span class="ot">=</span> empty_matrix)</span>
<span id="cb3-88"><a href="#cb3-88"></a>  </span>
<span id="cb3-89"><a href="#cb3-89"></a>  <span class="co"># clean</span></span>
<span id="cb3-90"><a href="#cb3-90"></a>  <span class="fu">rm</span>(empty_matrix)</span>
<span id="cb3-91"><a href="#cb3-91"></a>}</span>
<span id="cb3-92"><a href="#cb3-92"></a></span>
<span id="cb3-93"><a href="#cb3-93"></a><span class="co"># get pairwise distances</span></span>
<span id="cb3-94"><a href="#cb3-94"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_trees)){</span>
<span id="cb3-95"><a href="#cb3-95"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_trees[[j]])){</span>
<span id="cb3-96"><a href="#cb3-96"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_trees[[j]])){</span>
<span id="cb3-97"><a href="#cb3-97"></a>      </span>
<span id="cb3-98"><a href="#cb3-98"></a>      <span class="co"># get tree</span></span>
<span id="cb3-99"><a href="#cb3-99"></a>      tree1_tmp <span class="ot">=</span> combinatorial_trees[[j]][[i]]</span>
<span id="cb3-100"><a href="#cb3-100"></a>      tree2_tmp <span class="ot">=</span> combinatorial_trees[[j]][[k]]</span>
<span id="cb3-101"><a href="#cb3-101"></a></span>
<span id="cb3-102"><a href="#cb3-102"></a>      <span class="co"># list of common species</span></span>
<span id="cb3-103"><a href="#cb3-103"></a>      species_list <span class="ot">=</span> tree1_tmp<span class="sc">$</span>tip.label[<span class="fu">which</span>(tree1_tmp<span class="sc">$</span>tip.label <span class="sc">%in%</span> tree2_tmp<span class="sc">$</span>tip.label)]</span>
<span id="cb3-104"><a href="#cb3-104"></a></span>
<span id="cb3-105"><a href="#cb3-105"></a>      <span class="co"># get overlapping species</span></span>
<span id="cb3-106"><a href="#cb3-106"></a>      tree1 <span class="ot">=</span> ape<span class="sc">::</span><span class="fu">keep.tip</span>(tree1_tmp, species_list)</span>
<span id="cb3-107"><a href="#cb3-107"></a>      tree2 <span class="ot">=</span> ape<span class="sc">::</span><span class="fu">keep.tip</span>(tree2_tmp, species_list)</span>
<span id="cb3-108"><a href="#cb3-108"></a>      </span>
<span id="cb3-109"><a href="#cb3-109"></a>      <span class="co"># get distances</span></span>
<span id="cb3-110"><a href="#cb3-110"></a>      distances <span class="ot">=</span> phangorn<span class="sc">::</span><span class="fu">treedist</span>(tree1, tree2)</span>
<span id="cb3-111"><a href="#cb3-111"></a>      combinatorial_distances[[j]][[<span class="st">"RF"</span>]][i, k] <span class="ot">=</span> distances[[<span class="dv">1</span>]]</span>
<span id="cb3-112"><a href="#cb3-112"></a>      combinatorial_distances[[j]][[<span class="st">"KF"</span>]][i, k] <span class="ot">=</span> distances[[<span class="dv">2</span>]]</span>
<span id="cb3-113"><a href="#cb3-113"></a>      combinatorial_distances[[j]][[<span class="st">"MAST_%"</span>]][i, k] <span class="ot">=</span> <span class="fu">length</span>(phangorn<span class="sc">::</span><span class="fu">mast</span>(tree1, tree2, <span class="at">tree =</span> <span class="cn">FALSE</span>)) <span class="sc">/</span> <span class="fu">length</span>(species_list)</span>
<span id="cb3-114"><a href="#cb3-114"></a>      </span>
<span id="cb3-115"><a href="#cb3-115"></a>      <span class="co"># clean</span></span>
<span id="cb3-116"><a href="#cb3-116"></a>      <span class="fu">rm</span>(tree1, tree2, tree1_tmp, tree2_tmp, distances)</span>
<span id="cb3-117"><a href="#cb3-117"></a>    }</span>
<span id="cb3-118"><a href="#cb3-118"></a>  }</span>
<span id="cb3-119"><a href="#cb3-119"></a>}</span>
<span id="cb3-120"><a href="#cb3-120"></a></span>
<span id="cb3-121"><a href="#cb3-121"></a></span>
<span id="cb3-122"><a href="#cb3-122"></a><span class="do">### get pairwise common_nodes_corr distances</span></span>
<span id="cb3-123"><a href="#cb3-123"></a></span>
<span id="cb3-124"><a href="#cb3-124"></a><span class="co"># iterate all combinatorial trees</span></span>
<span id="cb3-125"><a href="#cb3-125"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_trees)){</span>
<span id="cb3-126"><a href="#cb3-126"></a>  </span>
<span id="cb3-127"><a href="#cb3-127"></a>  <span class="co"># create CPU cluster</span></span>
<span id="cb3-128"><a href="#cb3-128"></a>  cl <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(<span class="dv">8</span>, <span class="at">type =</span> <span class="st">"SOCK"</span>)</span>
<span id="cb3-129"><a href="#cb3-129"></a>  doSNOW<span class="sc">::</span><span class="fu">registerDoSNOW</span>(cl)</span>
<span id="cb3-130"><a href="#cb3-130"></a>  </span>
<span id="cb3-131"><a href="#cb3-131"></a>  <span class="co"># get chronos in parallel</span></span>
<span id="cb3-132"><a href="#cb3-132"></a>  chronos_list <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_trees[[j]]), <span class="at">.combine =</span> <span class="st">"c"</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb3-133"><a href="#cb3-133"></a>    <span class="fu">library</span>(<span class="st">"ape"</span>)</span>
<span id="cb3-134"><a href="#cb3-134"></a>    <span class="co"># get tree</span></span>
<span id="cb3-135"><a href="#cb3-135"></a>    <span class="fu">tryCatch</span>(<span class="fu">chronos</span>(combinatorial_trees[[j]][[k]]), <span class="at">error =</span> <span class="cf">function</span>(e) { <span class="cn">NA</span> })</span>
<span id="cb3-136"><a href="#cb3-136"></a>  }  </span>
<span id="cb3-137"><a href="#cb3-137"></a>  parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cl)</span>
<span id="cb3-138"><a href="#cb3-138"></a>  <span class="fu">names</span>(chronos_list) <span class="ot">=</span> <span class="fu">names</span>(combinatorial_trees[[j]])</span>
<span id="cb3-139"><a href="#cb3-139"></a>  </span>
<span id="cb3-140"><a href="#cb3-140"></a>  <span class="co"># get pairwise common_nodes_corr distances</span></span>
<span id="cb3-141"><a href="#cb3-141"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_trees[[j]])){</span>
<span id="cb3-142"><a href="#cb3-142"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_trees[[j]])){</span>
<span id="cb3-143"><a href="#cb3-143"></a>      </span>
<span id="cb3-144"><a href="#cb3-144"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(j, i, k, <span class="at">sep =</span> <span class="st">","</span>))</span>
<span id="cb3-145"><a href="#cb3-145"></a>      </span>
<span id="cb3-146"><a href="#cb3-146"></a>      <span class="co"># get trees</span></span>
<span id="cb3-147"><a href="#cb3-147"></a>      tree1_tmp <span class="ot">=</span> chronos_list[[<span class="fu">names</span>(combinatorial_trees[[j]])[i]]]</span>
<span id="cb3-148"><a href="#cb3-148"></a>      tree2_tmp <span class="ot">=</span> chronos_list[[<span class="fu">names</span>(combinatorial_trees[[j]])[k]]]</span>
<span id="cb3-149"><a href="#cb3-149"></a>      </span>
<span id="cb3-150"><a href="#cb3-150"></a>      <span class="co"># check trees and get distance</span></span>
<span id="cb3-151"><a href="#cb3-151"></a>      <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(tree1_tmp)) <span class="sc">&amp;</span> <span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(tree2_tmp))){</span>
<span id="cb3-152"><a href="#cb3-152"></a>        combinatorial_distances[[j]][[<span class="st">"common_nodes_corr"</span>]][i, k] <span class="ot">=</span> <span class="fu">tryCatch</span>(</span>
<span id="cb3-153"><a href="#cb3-153"></a>          <span class="fu">cor.dendlist</span>(<span class="fu">dendlist</span>(<span class="fu">as.dendrogram</span>(ape<span class="sc">::</span><span class="fu">root</span>(tree1_tmp, <span class="at">outgroup =</span> <span class="fu">c</span>(<span class="st">"Oviri"</span>, <span class="st">"Pakin"</span>), <span class="at">resolve.root =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb3-154"><a href="#cb3-154"></a>                                <span class="fu">as.dendrogram</span>(ape<span class="sc">::</span><span class="fu">root</span>(tree2_tmp, <span class="at">outgroup =</span> <span class="fu">c</span>(<span class="st">"Oviri"</span>, <span class="st">"Pakin"</span>), <span class="at">resolve.root =</span> <span class="cn">TRUE</span>))),</span>
<span id="cb3-155"><a href="#cb3-155"></a>                       <span class="at">method =</span> <span class="st">"common_nodes"</span>)[<span class="dv">2</span>],</span>
<span id="cb3-156"><a href="#cb3-156"></a>          <span class="at">error =</span> <span class="cf">function</span>(e) { <span class="cn">NA</span> })</span>
<span id="cb3-157"><a href="#cb3-157"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-158"><a href="#cb3-158"></a>        combinatorial_distances[[j]][[<span class="st">"common_nodes_corr"</span>]][i, k] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb3-159"><a href="#cb3-159"></a>      }</span>
<span id="cb3-160"><a href="#cb3-160"></a>    }</span>
<span id="cb3-161"><a href="#cb3-161"></a>  }</span>
<span id="cb3-162"><a href="#cb3-162"></a>}</span>
<span id="cb3-163"><a href="#cb3-163"></a></span>
<span id="cb3-164"><a href="#cb3-164"></a></span>
<span id="cb3-165"><a href="#cb3-165"></a><span class="do">## export the distance matrices</span></span>
<span id="cb3-166"><a href="#cb3-166"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(combinatorial_distances)){</span>
<span id="cb3-167"><a href="#cb3-167"></a>  <span class="fu">write.table</span>(combinatorial_distances[[i]][[<span class="st">"common_nodes_corr"</span>]],</span>
<span id="cb3-168"><a href="#cb3-168"></a>              <span class="at">file =</span> <span class="fu">paste</span>(<span class="st">"UlvaOmics."</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>), <span class="st">".05_combinatorial_stats.cp_mt_conc_"</span>, i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"_genes.common_nodes_corr.txt"</span>,  <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb3-169"><a href="#cb3-169"></a>              <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-170"><a href="#cb3-170"></a>  <span class="fu">write.table</span>(combinatorial_distances[[i]][[<span class="st">"RF"</span>]],</span>
<span id="cb3-171"><a href="#cb3-171"></a>              <span class="at">file =</span> <span class="fu">paste</span>(<span class="st">"UlvaOmics."</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>), <span class="st">".05_combinatorial_stats.cp_mt_conc_"</span>, i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"_genes.RF.txt"</span>,  <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb3-172"><a href="#cb3-172"></a>              <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-173"><a href="#cb3-173"></a>  <span class="fu">write.table</span>(combinatorial_distances[[i]][[<span class="st">"KF"</span>]],</span>
<span id="cb3-174"><a href="#cb3-174"></a>              <span class="at">file =</span> <span class="fu">paste</span>(<span class="st">"UlvaOmics."</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>), <span class="st">".05_combinatorial_stats.cp_mt_conc_"</span>, i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"_genes.KF.txt"</span>,  <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb3-175"><a href="#cb3-175"></a>              <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-176"><a href="#cb3-176"></a>  <span class="fu">write.table</span>(combinatorial_distances[[i]][[<span class="st">"MAST_%"</span>]],</span>
<span id="cb3-177"><a href="#cb3-177"></a>              <span class="at">file =</span> <span class="fu">paste</span>(<span class="st">"UlvaOmics."</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>), <span class="st">".05_combinatorial_stats.cp_mt_conc_"</span>, i <span class="sc">+</span> <span class="dv">1</span>, <span class="st">"_genes.MAST_%.txt"</span>,  <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb3-178"><a href="#cb3-178"></a>              <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">'</span><span class="sc">\t</span><span class="st">'</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>, <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-179"><a href="#cb3-179"></a>}</span>
<span id="cb3-180"><a href="#cb3-180"></a></span>
<span id="cb3-181"><a href="#cb3-181"></a></span>
<span id="cb3-182"><a href="#cb3-182"></a></span>
<span id="cb3-183"><a href="#cb3-183"></a><span class="co">#------------------------------------------------------------------------------#</span></span>
<span id="cb3-184"><a href="#cb3-184"></a><span class="do">## 2.3 - Plot distance matrices                                             ####</span></span>
<span id="cb3-185"><a href="#cb3-185"></a></span>
<span id="cb3-186"><a href="#cb3-186"></a></span>
<span id="cb3-187"><a href="#cb3-187"></a><span class="co"># </span></span>
<span id="cb3-188"><a href="#cb3-188"></a><span class="co"># for(k in 1:length(combinatorial_distances)){</span></span>
<span id="cb3-189"><a href="#cb3-189"></a><span class="co">#   </span></span>
<span id="cb3-190"><a href="#cb3-190"></a><span class="co">#   # remove possible rows/columns with only NAs</span></span>
<span id="cb3-191"><a href="#cb3-191"></a><span class="co">#   tmp_matrix = distance_sets[[i]][[k]]</span></span>
<span id="cb3-192"><a href="#cb3-192"></a><span class="co">#   tmp_matrix = tmp_matrix[, colSums(is.na(tmp_matrix)) &lt; nrow(tmp_matrix)]</span></span>
<span id="cb3-193"><a href="#cb3-193"></a><span class="co">#   tmp_matrix = tmp_matrix[rowSums(is.na(tmp_matrix)) &lt; ncol(tmp_matrix), ]</span></span>
<span id="cb3-194"><a href="#cb3-194"></a><span class="co">#   </span></span>
<span id="cb3-195"><a href="#cb3-195"></a><span class="co">#   # get names</span></span>
<span id="cb3-196"><a href="#cb3-196"></a><span class="co">#   plot_name = ifelse(names(distance_sets[[i]])[[k]] == "common_nodes_corr", "common\nnodes\ncorr", names(distance_sets[[i]])[[k]])</span></span>
<span id="cb3-197"><a href="#cb3-197"></a><span class="co">#   </span></span>
<span id="cb3-198"><a href="#cb3-198"></a><span class="co">#   # prep annotation</span></span>
<span id="cb3-199"><a href="#cb3-199"></a><span class="co">#   organell = as.data.frame(ifelse(rownames(tmp_matrix) %in% cp_genes_list, "cp",</span></span>
<span id="cb3-200"><a href="#cb3-200"></a><span class="co">#                                   ifelse(rownames(tmp_matrix) %in% mt_genes_list, "mt", "cp_mt")))</span></span>
<span id="cb3-201"><a href="#cb3-201"></a><span class="co">#   rownames(organell) = rownames(tmp_matrix)</span></span>
<span id="cb3-202"><a href="#cb3-202"></a><span class="co">#   colnames(organell) = "organell"</span></span>
<span id="cb3-203"><a href="#cb3-203"></a><span class="co">#   organell$color = ifelse(organell$organell == "cp", "#469d89", ifelse(organell$organell == "mt", "steelblue", "red"))</span></span>
<span id="cb3-204"><a href="#cb3-204"></a><span class="co">#   </span></span>
<span id="cb3-205"><a href="#cb3-205"></a><span class="co">#   # plot raw distance</span></span>
<span id="cb3-206"><a href="#cb3-206"></a><span class="co">#   distances_plots[[i]][[k]] = grid.grabExpr(draw(ComplexHeatmap::Heatmap(tmp_matrix,</span></span>
<span id="cb3-207"><a href="#cb3-207"></a><span class="co">#                                                                          col = colorRamp2(c(min(tmp_matrix[!is.na(tmp_matrix)]),</span></span>
<span id="cb3-208"><a href="#cb3-208"></a><span class="co">#                                                                                             max(tmp_matrix[!is.na(tmp_matrix)])),</span></span>
<span id="cb3-209"><a href="#cb3-209"></a><span class="co">#                                                                                           c("white", "#D55E00")),</span></span>
<span id="cb3-210"><a href="#cb3-210"></a><span class="co">#                                                                          row_names_gp = gpar(col = organell$color),</span></span>
<span id="cb3-211"><a href="#cb3-211"></a><span class="co">#                                                                          column_names_gp = gpar(col = organell$color),</span></span>
<span id="cb3-212"><a href="#cb3-212"></a><span class="co">#                                                                          top_annotation = HeatmapAnnotation(organell = as.matrix(organell$organell),</span></span>
<span id="cb3-213"><a href="#cb3-213"></a><span class="co">#                                                                                                             show_annotation_name = FALSE,</span></span>
<span id="cb3-214"><a href="#cb3-214"></a><span class="co">#                                                                                                             show_legend = FALSE,</span></span>
<span id="cb3-215"><a href="#cb3-215"></a><span class="co">#                                                                                                             col = list(organell = c("cp_mt" = "red", "cp" = "#469d89", "mt" = "steelblue"))),</span></span>
<span id="cb3-216"><a href="#cb3-216"></a><span class="co">#                                                                          left_annotation = rowAnnotation(organell = as.matrix(organell$organell),</span></span>
<span id="cb3-217"><a href="#cb3-217"></a><span class="co">#                                                                                                          show_annotation_name = FALSE,</span></span>
<span id="cb3-218"><a href="#cb3-218"></a><span class="co">#                                                                                                          col = list(organell = c("cp_mt" = "red", "cp" = "#469d89", "mt" = "steelblue"))),</span></span>
<span id="cb3-219"><a href="#cb3-219"></a><span class="co">#                                                                          name = plot_name)))</span></span>
<span id="cb3-220"><a href="#cb3-220"></a><span class="co">#   grid.newpage(recording = TRUE)</span></span>
<span id="cb3-221"><a href="#cb3-221"></a><span class="co">#   grid.draw(distances_plots[[i]][[k]])</span></span>
<span id="cb3-222"><a href="#cb3-222"></a><span class="co"># </span></span>
<span id="cb3-223"><a href="#cb3-223"></a><span class="co"># </span></span>
<span id="cb3-224"><a href="#cb3-224"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To resolve Ulva species phylogenetic relationships, supermatrix and coalescence-based phylogenetic approaches were applied to the chloroplast and mitochondrial datasets. To appreciate the different phylogenetic signals present in the two organellar datasets, the chloroplast and mitochondrial datasets were first analyzed independently. Afterwards, a supermatrix containing both chloroplast and mitochondrial genes was composed in order to infer the Ulva species phylogenetic tree. For the supermatrix Maximum-likelihood (ML) reconstruction, a gene-wise partitioned analysis was performed (Chernomor et al 2016). To estimate the best substitution model of each partition, ML trees were built with IQtree v.2.2.0 (Minh et al 2020) for each single-copy gene, inferring the best model and rate of heterogeneity across sites. All ML analyses were run with 1,000 ultra-fast bootstrap and SH-aLRT branch test replicates. Gene trees were used also for the coalescent-based analyses, using ASTRAL v5.7.8 (Zhang et al 2018), using the multilocus bootstrap support (MLBS) approach. 100 replicates were run (-r) starting from the 1,000 bootstrap trees generated for each gene during the ML analyses, allowing gene and site resampling (–gene-resampling flag). Four metrics were used to assess the concordance of the Ulva species tree reconstructed from supermatrix and coalescence-based analyses obtained from the analyses of chloroplast genes, mitochondrial genes and chloroplast and mitochondrial genes: Robinson-Foulds (Robinson &amp; Foulds 1981), Kuhner-Felsenstein (Kuhner &amp; Felsenstein 1994), Maximum Agreement Subtree (Finden &amp; Gordon 1985) calculated with phangorn package (Schliep 2011), and correlation between the common nodes calculated with corr.dendlist function from dendexted package (Galili 2015). The RF distance measures the number of unique splits between two trees by comparing their bipartitions. It ranges from 0 (identical trees) to a higher value indicating greater dissimilarity with more unique splits (Robinson &amp; Foulds 1981). The KF index quantifies the average genetic differences per site between populations, considering genetic variation within and between populations to provide a quantitative measure of genetic distance (Kuhner &amp; Felsenstein 1994). The MAST (%) identifies the subset of nodes and branches that are common to both trees, disregarding any additional or missing branches. It aims to find the largest possible subtree that can be extracted from both trees while preserving their structural similarities, representing the maximum level of agreement in their branching patterns (Finden &amp; Gordon 1985). The correlation between the common nodes is calculated as the pairwise cophenetic correlation coefficient between the distance matrix and the cophenetic matrix of the common nodes (Galili 2015). Both phangorn and dendextend packages are available in R statistical programming language (R Core Team 2022). Organellar gene ranking To identify the minimum number of genes (markers) necessary to reconstruct the Ulva species tree reconstructed with the 99 chloroplast and mitochondrial markers, Robinson-Foulds, Kuhner-Felsenstein, Maximum Agreement Subtree and correlation between the common nodes metrics were calculated between each of the 99 chloroplast and mitochondrial markers and the Ulva species tree reconstructed from supermatrix analysis. The same approach applied to the Ulva species trees reconstructed using chloroplast and mitochondrial supermatrix and coalesce-based analyses suggested that Maximum Agreement Subtree and common correlation nodes metrics are the best performers to assess phylogenetic tree distances when the tree do not have the same set of tips. The 10 markers (6 chloroplasts and 4 mitochondrial) with the best MAST% and common correlation nodes scores were arbitrarily chosen as candidates for the subsequent combinatorial phylogenetic analyses. Combinatorial phylogenetic analysis For the combinatorial phylogenetic analysis, a custom python script was used to exhaustively calculate the permutations between the chosen 10 marker genes, sampling between 2 and 10 markers. This resulted in the 945 unique combinations of at least a chloroplast and a mitochondrial marker (24 combinations of 2 marker genes, 96 of 3 markers, 194 of 4 markers, 246 of 5 markers, 209 of 6 markers, 120 of 7 markers, 45 of 8 markers, 10 of 9 markers and finally 1 containing all 10 markers genes). For each combination of markers, the script would then independently reconstruct the corresponding phylogenetic tree by invoking IQtree, inferring the best model and rate of heterogeneity across sites, with 1,000 ultra-fast bootstrap and SH-aLRT branch test replicates. Four metrics (RF, KF, MAST% and common correlation nodes scores) between each of the reconstructed 945 tree and the Ulva species tree reconstructed with the 99 chloroplast and mitochondrial markers were calculated in an iterative manner to identify the minimum set of chloroplast and mitochondrial markers necessary to reconstruct a ML phylogenetic tree concordant with the Ulva species tree reconstructed in this study. These markers are suggested to be used as a novel combination of markers to molecularly characterize Ulva species, and universal primers will be designed for each of the markers.</p>
</section>
</section>
<section id="sec-lesson-learnt-markers-selection" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-lesson-learnt-markers-selection"><span class="header-section-number">3.4</span> Lessons Learnt</h2>
<p>So far, we have learnt:</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./cp-and-mt-phylogeny-reconstruction.html" class="pagination-link" aria-label="Species tree reconstruction from organellar genomes">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Species tree reconstruction from organellar genomes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright © 2025 Andrea Del Cortona.
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://quarto.org/">
<p>This page is built with ❤️ and <em>Quarto</em>.</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/19ADC99">
      <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/andrea-del-cortona-86a75474/">
      <i class="bi bi-linkedin" role="img" aria-label="Lindekin">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>